"use strict";(self.webpackChunkalnitak=self.webpackChunkalnitak||[]).push([[193],{7193:(dt,v,a)=>{a.r(v),a.d(v,{ChordPageComponent:()=>lt});var t=a(9590),P=a(8834),m=a(1801),b=a(3902),h=a(6138),T=a(2510);const K=(0,a(4019).A)(function(s,e){return Array.prototype.slice.call(e,0).sort(s)});var f=a(9189),F=a(7508);function M(i,s){if(1&i&&t.EFF(0),2&i){const e=t.XpG().$implicit;t.SpI(" ",e.value," ")}}function B(i,s){if(1&i&&(t.j41(0,"mat-icon"),t.EFF(1),t.nI1(2,"iconGuard"),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,e.value)," ")}}function G(i,s){1&i&&(t.j41(0,"span"),t.EFF(1,"+"),t.k0s())}function $(i,s){if(1&i&&t.DNE(0,M,1,1)(1,B,3,3)(2,G,2,0,"span"),2&i){const o=s.$index,n=s.$count;t.vxM(0,"character"===s.$implicit.type?0:1),t.R7$(2),t.vxM(2,o!==n-1?2:-1)}}let V=(()=>{class i{constructor(){this.keys=t.hFB.required()}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-chord-input-keys"]],inputs:{keys:[t.Mj6.SignalBased,"keys"]},standalone:!0,features:[t.aNF],decls:2,vars:0,template:function(o,n){1&o&&t.Z7z(0,$,3,2,null,null,t.Vm6),2&o&&t.Dyx(n.keys())},dependencies:[m.An,f.B],encapsulation:2,changeDetection:0})}return i})();function R(i,s){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.value)}}function D(i,s){if(1&i&&(t.j41(0,"mat-icon",0),t.EFF(1),t.nI1(2,"iconGuard"),t.k0s()),2&i){const e=t.XpG().$implicit;t.Y8G("inline",!0),t.R7$(),t.JRh(t.bMT(2,2,e.value))}}function N(i,s){1&i&&t.DNE(0,R,2,1,"span")(1,D,3,4),2&i&&t.vxM(0,"character"===s.$implicit.type?0:1)}let S=(()=>{class i{constructor(){this.keys=t.hFB.required(),this.hostClasses=["inline-flex","align-center"]}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-chord-output-keys"]],hostVars:2,hostBindings:function(o,n){2&o&&t.HbH(n.hostClasses)},inputs:{keys:[t.Mj6.SignalBased,"keys"]},standalone:!0,features:[t.aNF],decls:2,vars:0,consts:[[3,"inline"]],template:function(o,n){1&o&&t.Z7z(0,N,2,1,null,null,t.Vm6),2&o&&t.Dyx(n.keys())},dependencies:[m.An,f.B],encapsulation:2,changeDetection:0})}return i})();const W=["fileInput"],Q=(i,s)=>s.id;function X(i,s){if(1&i&&(t.j41(0,"mat-list-option",7),t.nrm(1,"app-chord-input-keys",9),t.EFF(2," -> "),t.nrm(3,"app-chord-output-keys",9),t.k0s()),2&i){const e=s.$implicit,o=t.XpG();t.Y8G("color","primary")("value",e)("togglePosition","before")("selected",o.selectedChordIds().has(e.id)),t.R7$(),t.Y8G("keys",e.inputKeys),t.R7$(2),t.Y8G("keys",e.outputKeys)}}const w=K((i,s)=>i-s);let L=(()=>{class i{constructor(){this.chordStore=(0,t.WQX)(F.C),this.chords=t.hFB.required(),this.selectedChordIds=t.hFB.required(),this.selectionChange=(0,t.CGW)(),this.startPractice=(0,t.CGW)(),this.classes="flex flex-col"}loadChordFile(){if(typeof FileReader>"u")return;const e=this.fileInput.nativeElement;if(null===e.files||0===e.files.length)return;const o=new FileReader;o.onload=n=>{if(!n.target?.result)return;const r=JSON.parse(n.target.result);if(!r)return;let c=null;c=r.history?r.history[0].find(l=>"chords"===l.type):r,c&&(0,h.M8)(this.chordStore,(0,T.a8)(c.chords.map(([l,d])=>{const p=l.filter(ht=>ht>0);return{id:w(p).join("_"),input:p,output:d}})))},o.readAsText(e.files[0])}onChordSelectionChange(e){this.selectionChange.emit(e)}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-chord-practice-setting"]],viewQuery:function(o,n){if(1&o&&t.GBs(W,5),2&o){let r;t.mGM(r=t.lsd())&&(n.fileInput=r.first)}},hostVars:1,hostBindings:function(o,n){2&o&&t.Mr5("classes",n.classes)},inputs:{chords:[t.Mj6.SignalBased,"chords"],selectedChordIds:[t.Mj6.SignalBased,"selectedChordIds"]},outputs:{selectionChange:"selectionChange",startPractice:"startPractice"},standalone:!0,features:[t.aNF],decls:29,vars:9,consts:[["fileInput",""],[1,"flex","h-12","flex-none","items-center","bg-gray-700","px-5"],[1,"flex-1","list-inside","list-decimal","overflow-auto","p-5"],["href","https://charachorder.io/","target","_blank","rel","noopener",1,"underline"],["type","button","mat-flat-button","",1,"my-2",3,"click","color"],["hidden","","type","file","accept",".json","aria-label","file input for selecting a chord map file to load into this tool",3,"change"],[1,"!my-2","max-h-56","overflow-auto","rounded","border",3,"selectionChange"],[3,"color","value","togglePosition","selected"],["type","button","mat-flat-button","",1,"my-2",3,"click","color","disabled"],[3,"keys"]],template:function(o,n){if(1&o){const r=t.RV6();t.j41(0,"section",1),t.EFF(1," Chord - Practice Setting\n"),t.k0s(),t.j41(2,"ol",2)(3,"li"),t.EFF(4," Import your chord list file (the backup file from "),t.j41(5,"a",3),t.EFF(6,"CharaChorder Device Manager"),t.k0s(),t.EFF(7," website). (for first time usage or updating the chord list) "),t.nrm(8,"br"),t.j41(9,"button",4),t.bIt("click",function(){t.eBV(r);const l=t.sdS(15);return t.Njj(l.click())}),t.j41(10,"mat-icon"),t.EFF(11),t.nI1(12,"iconGuard"),t.k0s(),t.EFF(13," Choose File "),t.k0s(),t.j41(14,"input",5,0),t.bIt("change",function(){return t.eBV(r),t.Njj(n.loadChordFile())}),t.k0s()(),t.j41(16,"li"),t.EFF(17," Select the chords you want to practice from the imported chord list below. "),t.j41(18,"mat-selection-list",6),t.bIt("selectionChange",function(l){return t.eBV(r),t.Njj(n.onChordSelectionChange(l))}),t.Z7z(19,X,4,6,"mat-list-option",7,Q),t.k0s()(),t.j41(21,"li"),t.EFF(22," Click the following button to start. "),t.nrm(23,"br"),t.j41(24,"button",8),t.bIt("click",function(){return t.eBV(r),t.Njj(n.startPractice.emit())}),t.j41(25,"mat-icon"),t.EFF(26),t.nI1(27,"iconGuard"),t.k0s(),t.EFF(28," Start "),t.k0s()()()}2&o&&(t.R7$(9),t.Y8G("color","primary"),t.R7$(2),t.JRh(t.bMT(12,5,"upload")),t.R7$(8),t.Dyx(n.chords()),t.R7$(5),t.Y8G("color","primary")("disabled",0===n.selectedChordIds().size),t.R7$(2),t.JRh(t.bMT(27,7,"play_arrow")))},dependencies:[P.$z,m.An,b.p6,b.oh,V,S,f.B],encapsulation:2,changeDetection:0})}return i})();var U=a(1635),Y=a(8954),_=a(9894),A=a(605),O=a(6148),k=a(1380),z=a(1159),H=a(4796),y=a(6898);const I=(0,h.Eu)({providedIn:"root"},(0,H.JT)("chordPractice"),(0,h.Q2)({chords:null,queue:[],history:[],lastCorrectChordTime:null,chordIntervals:[],buffer:[]}),(0,h.RI)(i=>({setChords(s){(0,h.M8)(i,()=>({chords:s,queue:(0,y.q)(s,20),history:[],chordIntervals:[]}))},airType(){(0,h.M8)(i,({queue:s,chords:e,history:o,lastCorrectChordTime:n,chordIntervals:r})=>{if(!e)return{};const c=Date.now();return{queue:[...s.slice(1),(0,y.QD)(e)],history:[...o,s[0]].slice(-3),lastCorrectChordTime:c,chordIntervals:n?[...r,c-n]:[...r],buffer:[]}})},input(s){(0,h.M8)(i,({buffer:e,queue:o,chords:n,history:r,lastCorrectChordTime:c,chordIntervals:l})=>{if(!n)return{};const d=Date.now(),p=[...e];if("deleteContentBackward"===s.inputType)p.pop();else{if("insertText"!==s.inputType||!s.data)return{};p.push(s.data)}return p.join("").trim()===o[0].outputText?{queue:[...o.slice(1),(0,y.QD)(n)],history:[...r,o[0]].slice(-3),lastCorrectChordTime:d,chordIntervals:c?[...l,d-c]:[...l],buffer:[]}:{buffer:p}})}})),(0,h.QO)(i=>({chpm:(0,t.EWP)(()=>{const s=i.chordIntervals(),e=s.reduce((n,r)=>n+r,0)/1e3/60;return 0===e?0:Math.floor(s.length/e)})})));var q=a(2999),j=a(7877),tt=a(9263),u=a(2097),et=a(5888),ot=a(629);const it=["input"];function nt(i,s){1&i&&t.nrm(0,"app-chord-output-keys",5),2&i&&t.Y8G("keys",s.$implicit.outputKeys)}function st(i,s){1&i&&t.nrm(0,"app-chord-output-keys",5),2&i&&t.Y8G("keys",s.$implicit.outputKeys)}function rt(i,s){if(1&i&&t.nrm(0,"app-speedometer",15),2&i){const e=t.XpG();t.AVh("opacity-50",e.isFocus()),t.Y8G("speed",e.chordPracticeStore.chpm())("maxSpeed",100)("speedUnit","ChPM")}}let C=class g{constructor(){this.chordPracticeStore=(0,t.WQX)(I),this.visibilitySettingStore=(0,t.WQX)(tt.e),this.hotkeysService=(0,t.WQX)(Y.dr),this.isFocus=(0,t.vPA)(!1),this.shortcuts={startPractice:"space",pausePractice:"escape"},this.classes="flex flex-col h-full",this.keyboardLayout=(0,t.WQX)(j.h).selectedEntity,this.deviceLayout=(0,t.WQX)(q.G).selectedEntity,this.airModeSettingStore=(0,t.WQX)(z.$),this.practiceCharactersDevicePositionCodes=(0,t.EWP)(()=>{const s=this.chordPracticeStore.chords(),e=this.deviceLayout(),o=this.keyboardLayout();return[...new Set(s?.map(r=>r.input).flat())].map(r=>{const c=(0,u.VW)(r,o);return c?{c:c.value,characterDeviceKeys:(0,u.U)([{actionCode:r,shiftKey:!1,altGraphKey:!1}],e)}:null})}),this.keyLabelMap=(0,t.EWP)(()=>{const s=this.practiceCharactersDevicePositionCodes();if(!s)return{};const e={};return s.forEach(o=>{o?.characterDeviceKeys?.forEach(({characterKeyPositionCode:n,layer:r,shiftKey:c,altGraphKey:l})=>{const d={type:k.g0.String,c:o.c,title:`Character: ${o.c}`,layer:r,shiftKey:c,altGraphKey:l};e[n]?e[n].push(d):e[n]=[d]})}),e}),this.highlightChordKeyCombinationMap=(0,t.EWP)(()=>{const s=this.chordPracticeStore.chords(),e=this.deviceLayout();if(!this.practiceCharactersDevicePositionCodes())return{};const n={};return s?.forEach(r=>{n[r.id]={characterKeyPositionCode:-1,layer:k.Wd.Primary,shiftKey:!1,altGraphKey:!1,positionCodes:r.input.map(c=>(0,u.U)([{actionCode:c,shiftKey:!1,altGraphKey:!1}],e)?.map(l=>l.characterKeyPositionCode)).flat(),score:0}}),n}),this.highlightKeyCombination=(0,t.EWP)(()=>{const s=this.chordPracticeStore.queue()[0];return this.highlightChordKeyCombinationMap()[s.id]})}onInput(s){this.chordPracticeStore.input(s)}startPractice(){if(this.input.nativeElement.focus(),this.airModeSettingStore.enabled()){const e=this.airModeSettingStore.chordSpeed();(0,A.Y)(6e4/e).pipe((0,_.s)(this)).subscribe(()=>{this.chordPracticeStore.airType()})}}endPractice(){this.input.nativeElement.blur()}ngOnInit(){this.hotkeysService.addShortcut({keys:this.shortcuts.startPractice}).subscribe(()=>{this.startPractice()}),this.hotkeysService.addShortcut({keys:this.shortcuts.pausePractice,allowIn:["INPUT"]}).subscribe(()=>{this.endPractice()})}ngOnDestroy(){this.hotkeysService.removeShortcuts([this.shortcuts.startPractice,this.shortcuts.pausePractice])}static#t=this.\u0275fac=function(e){return new(e||g)};static#e=this.\u0275cmp=t.VBU({type:g,selectors:[["app-chord-practice"]],viewQuery:function(e,o){if(1&e&&t.GBs(it,7),2&e){let n;t.mGM(n=t.lsd())&&(o.input=n.first)}},hostVars:2,hostBindings:function(e,o){2&e&&t.HbH(o.classes)},standalone:!0,features:[t.aNF],decls:23,vars:10,consts:[["input",""],[1,"flex","h-12","flex-none","items-center","bg-gray-700","px-5"],[1,"flex-none"],[1,"relative","h-16","overflow-hidden"],[1,"history","absolute","top-2","space-x-1","whitespace-nowrap","text-gray-300"],[3,"keys"],[1,"absolute","left-24","top-2","space-x-1","whitespace-nowrap"],[1,"absolute","bottom-2","left-24","whitespace-nowrap","text-alnitak-300"],[1,"animate-ping","border-l","border-solid","border-alnitak-300"],["type","text","inputmode","none",1,"peer","h-0","w-0","opacity-0",3,"input","focus","blur"],[1,"absolute","inset-0","flex","cursor-pointer","items-center","justify-center","gap-2","bg-gray-500","text-white","peer-focus:pointer-events-none","peer-focus:opacity-0"],["mat-flat-button","",3,"click"],[1,"text-white"],[1,"box-border","block","flex-1","overflow-hidden","px-5","pb-5",3,"showThumb3Switch","keyLabelMap","highlightKeyCombination"],["class","absolute bottom-4 right-4 h-24 w-24 opacity-50",3,"opacity-50","speed","maxSpeed","speedUnit",4,"appVisible"],[1,"absolute","bottom-4","right-4","h-24","w-24","opacity-50",3,"speed","maxSpeed","speedUnit"]],template:function(e,o){if(1&e){const n=t.RV6();t.j41(0,"section",1),t.EFF(1," Chord - Practice\n"),t.k0s(),t.j41(2,"section",2)(3,"div",3)(4,"div",4),t.Z7z(5,nt,1,1,"app-chord-output-keys",5,t.Vm6),t.k0s(),t.j41(7,"div",6),t.Z7z(8,st,1,1,"app-chord-output-keys",5,t.Vm6),t.k0s(),t.j41(10,"div",7),t.EFF(11),t.nrm(12,"span",8),t.k0s(),t.j41(13,"input",9,0),t.bIt("input",function(c){return t.eBV(n),t.Njj(o.onInput(c))})("focus",function(){return t.eBV(n),t.Njj(o.isFocus.set(!0))})("blur",function(){return t.eBV(n),t.Njj(o.isFocus.set(!1))}),t.k0s(),t.j41(15,"div",10)(16,"button",11),t.bIt("click",function(){return t.eBV(n),t.Njj(o.startPractice())}),t.j41(17,"mat-icon",12),t.EFF(18),t.nI1(19,"iconGuard"),t.k0s(),t.EFF(20," Start "),t.k0s()()()(),t.nrm(21,"app-layout",13),t.DNE(22,rt,1,5,"app-speedometer",14)}2&e&&(t.R7$(4),t.xc7("right","calc(100% - 96px)"),t.R7$(),t.Dyx(o.chordPracticeStore.history()),t.R7$(3),t.Dyx(o.chordPracticeStore.queue()),t.R7$(3),t.SpI(" ",o.chordPracticeStore.buffer().join(""),""),t.R7$(7),t.JRh(t.bMT(19,8,"play_arrow")),t.R7$(3),t.Y8G("showThumb3Switch",o.visibilitySettingStore.layoutThumb3Switch())("keyLabelMap",o.keyLabelMap())("highlightKeyCombination",o.isFocus()?o.highlightKeyCombination():null),t.R7$(),t.Y8G("appVisible","speedometer"))},dependencies:[S,m.An,P.$z,et.C,ot.B,O.U,f.B],encapsulation:2,changeDetection:0})};function ct(i,s){if(1&i){const e=t.RV6();t.j41(0,"app-chord-practice-setting",0),t.bIt("selectionChange",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.onChordSelectionChange(n))})("startPractice",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.startChordPractice())}),t.k0s()}if(2&i){const e=t.XpG();t.Y8G("chords",e.chords())("selectedChordIds",e.selectedChordIds())}}function at(i,s){1&i&&t.nrm(0,"app-chord-practice")}C=(0,U.Cg)([(0,_.d)()],C);let lt=(()=>{class i{constructor(){this.chordStore=(0,t.WQX)(F.C),this.keyboardLayout=(0,t.WQX)(j.h).selectedEntity,this.chordPracticeStore=(0,t.WQX)(I),this.selectedChordIds=(0,t.vPA)(new Set),this.stage=(0,t.vPA)("setting"),this.chords=(0,t.EWP)(()=>{const e=this.chordStore.entities(),o=this.keyboardLayout();return e.map(n=>{const r=n.output.map(c=>(0,u.VW)(c,o));return{...n,inputKeys:n.input.map(c=>(0,u.VW)(c,o)),outputKeys:r,outputText:r.filter(c=>"character"===c?.type).map(c=>c?.value).join("")}}).filter(n=>n.inputKeys.every(r=>null!==r)&&n.outputKeys.every(r=>null!==r))})}onChordSelectionChange({options:e}){let o=this.selectedChordIds();e.forEach(n=>{n.selected?o.add(n.value.id):o.delete(n.value.id)}),this.selectedChordIds.set(o)}startChordPractice(){this.chordPracticeStore.setChords(this.chords().filter(e=>this.selectedChordIds().has(e.id))),this.stage.set("practice")}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-chord-page"]],standalone:!0,features:[t.aNF],decls:2,vars:1,consts:[[3,"selectionChange","startPractice","chords","selectedChordIds"]],template:function(o,n){if(1&o&&t.DNE(0,ct,1,2)(1,at,1,0),2&o){let r;t.vxM(0,"setting"===(r=n.stage())?0:"practice"===r?1:-1)}},dependencies:[L,C],encapsulation:2,changeDetection:0})}return i})()}}]);